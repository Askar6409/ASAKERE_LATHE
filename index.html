<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø³ÛŒØ³ØªÙ… ÙØ±ÙˆØ´ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>

<style>
body {
  background: #0f0f0f;
  color: white;
  font-family: sans-serif;
  padding: 12px;
}

h2 {
  text-align: center;
}

.card {
  background: #1c1c1c;
  border-radius: 14px;
  padding: 10px;
  margin-bottom: 10px;
}

input, button {
  padding: 8px;
  border-radius: 8px;
  border: none;
  width: 100%;
  margin-top: 6px;
}

button {
  background: #2ecc71;
  font-weight: bold;
  cursor: pointer;
}

button:hover {
  opacity: 0.85;
}

.product {
  display: grid;
  grid-template-columns: 1fr 80px 80px 60px;
  gap: 6px;
  align-items: center;
  background: #222;
  padding: 8px;
  border-radius: 10px;
  margin-top: 5px;
}

.total {
  text-align: center;
  font-size: 18px;
  font-weight: bold;
}

.history {
  max-height: 250px;
  overflow-y: auto;
}
</style>
</head>

<body>

<h2>ğŸ§¾ Ø³ÛŒØ³ØªÙ… ÙØ±ÙˆØ´ Ø¨Ø§Ø²Ø§Ø±</h2>

<div class="card">
  <b>ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ</b>
  <input id="customerName" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ">
  <input id="customerPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„">
</div>

<div class="card">
  <b>â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</b>
  <input id="newName" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„">
  <input id="newPrice" placeholder="Ù‚ÛŒÙ…Øª">
  <input id="newStock" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ">
  <button onclick="addProduct()">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø­ØµÙˆÙ„</button>
</div>

<div class="card">
  <b>ğŸ“¦ Ù…Ø­ØµÙˆÙ„Ø§Øª</b>
  <div id="products"></div>
</div>

<div class="card total" id="total">Ø¬Ù…Ø¹ Ú©Ù„: 0 ØªÙˆÙ…Ø§Ù†</div>

<button onclick="generateInvoice()">ğŸ§¾ ØµØ¯ÙˆØ± ÙØ§Ú©ØªÙˆØ±</button>

<div class="card">
  <b>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙØ±ÙˆØ´</b>
  <div id="history" class="history"></div>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [
  { name: "Ù¾ÛŒÚ†", price: 1000, stock: 50 },
  { name: "Ù…Ù‡Ø±Ù‡", price: 800, stock: 80 },
  { name: "Ø¨Ù„Ø¨Ø±ÛŒÙ†Ú¯", price: 12000, stock: 15 }
];

let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
let invoiceNumber = Number(localStorage.getItem("invoiceNumber")) || 1;

const container = document.getElementById("products");

function save() {
  localStorage.setItem("products", JSON.stringify(products));
  localStorage.setItem("invoices", JSON.stringify(invoices));
  localStorage.setItem("invoiceNumber", invoiceNumber);
}

function renderProducts() {
  container.innerHTML = "";

  products.forEach((p, i) => {
    let div = document.createElement("div");
    div.className = "product";

    div.innerHTML = `
      <div>${p.name}<br><small>Ù…ÙˆØ¬ÙˆØ¯ÛŒ: ${p.stock}</small></div>
      <input id="price-${i}" value="${p.price}">
      <input id="qty-${i}" value="0">
      <input type="checkbox" onchange="calculateTotal()">
    `;

    container.appendChild(div);
  });

  calculateTotal();
}

function addProduct() {
  let name = document.getElementById("newName").value.trim();
  let price = Number(document.getElementById("newPrice").value);
  let stock = Number(document.getElementById("newStock").value);

  if (!name || price <= 0 || stock < 0) {
    alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„ Ù†Ø§Ù‚Øµ Ø§Ø³Øª!");
    return;
  }

  products.push({ name, price, stock });
  save();
  renderProducts();

  document.getElementById("newName").value = "";
  document.getElementById("newPrice").value = "";
  document.getElementById("newStock").value = "";
}

function calculateTotal() {
  let total = 0;

  products.forEach((p, i) => {
    let qty = Number(document.getElementById("qty-" + i).value) || 0;
    let price = Number(document.getElementById("price-" + i).value) || 0;
    let checked = container.children[i].querySelector("input[type=checkbox]").checked;

    products[i].price = price;

    if (checked) {
      total += qty * price;
    }
  });

  save();
  document.getElementById("total").innerText =
    "Ø¬Ù…Ø¹ Ú©Ù„: " + total.toLocaleString() + " ØªÙˆÙ…Ø§Ù†";
}

function generateInvoice() {
  let name = document.getElementById("customerName").value.trim();
  let phone = document.getElementById("customerPhone").value.trim();

  let items = [];
  let total = 0;

  products.forEach((p, i) => {
    let qty = Number(document.getElementById("qty-" + i).value) || 0;
    let checked = container.children[i].querySelector("input[type=checkbox]").checked;

    if (checked && qty > 0) {
      if (qty > p.stock) {
        alert(`Ù…ÙˆØ¬ÙˆØ¯ÛŒ ${p.name} Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª`);
        return;
      }

      p.stock -= qty;
      let sum = qty * p.price;
      total += sum;

      items.push(`${p.name} Ã— ${qty} = ${sum.toLocaleString()} ØªÙˆÙ…Ø§Ù†`);
    }
  });

  if (!items.length) {
    alert("Ù…Ø­ØµÙˆÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡!");
    return;
  }

  let invoice = {
    number: invoiceNumber++,
    customer: name || "â€”",
    phone: phone || "â€”",
    date: new Date().toLocaleString(),
    items,
    total
  };

  invoices.unshift(invoice);
  save();
  renderHistory();
  renderProducts();

  document.getElementById("customerName").value = "";
  document.getElementById("customerPhone").value = "";

  alert("ÙØ§Ú©ØªÙˆØ± ØµØ§Ø¯Ø± Ø´Ø¯ âœ…");
}

function renderHistory() {
  let div = document.getElementById("history");
  div.innerHTML = "";

  invoices.forEach(inv => {
    let box = document.createElement("div");
    box.style.marginBottom = "10px";
    box.innerHTML = `
      <b>ğŸ§¾ ÙØ§Ú©ØªÙˆØ± #${inv.number}</b><br>
      ğŸ‘¤ ${inv.customer} | ğŸ“± ${inv.phone}<br>
      ğŸ“… ${inv.date}<br>
      ${inv.items.join("<br>")}
      <hr>
      <b>Ø¬Ù…Ø¹ Ú©Ù„: ${inv.total.toLocaleString()} ØªÙˆÙ…Ø§Ù†</b>
      <hr>
    `;
    div.appendChild(box);
  });
}

renderProducts();
renderHistory();
</script>

</body>
</html>
